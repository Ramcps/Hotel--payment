<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Booking Bot</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to right, #e0f7fa, #ffffff);
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .chat-container {
      width: 400px;
      height: 620px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .chat-box {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .message {
      margin: 6px 0;
      padding: 10px 14px;
      border-radius: 20px;
      max-width: 80%;
      word-wrap: break-word;
      font-size: 15px;
      line-height: 1.4;
    }
    .bot {
      background: #e1f5fe;
      align-self: flex-start;
    }
    .user {
      background: #007aff;
      color: white;
      align-self: flex-end;
    }
    .input-area {
      display: flex;
      border-top: 1px solid #ccc;
    }
    .input-area input {
      flex: 1;
      padding: 12px;
      border: none;
      font-size: 14px;
    }
    .input-area button {
      background: #007aff;
      color: white;
      border: none;
      padding: 12px 16px;
      font-weight: bold;
      cursor: pointer;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .options button {
      padding: 8px 14px;
      border: none;
      border-radius: 20px;
      background-color: #eeeeee;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .options button:hover {
      background-color: #d0d0d0;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-box" id="chat"></div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Type only if needed..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    let state = "start";
    let memory = {};

    function addMessage(text, sender = 'bot') {
      const div = document.createElement("div");
      div.className = `message ${sender}`;
      div.innerHTML = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, 'user');
      input.value = '';
      handleChat(text);
    }

    function showOptions(options, callback) {
      const div = document.createElement("div");
      div.className = "options";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          addMessage(opt, 'user');
          chat.removeChild(div);
          callback(opt);
        };
        div.appendChild(btn);
      });
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function initChat() {
      addMessage("Welcome to Zippy Stays! üè®");
      showOptions(["1. Room Booking", "2. Room Availability", "3. Support"], handleChat);
    }

    function handleChat(text) {
      if (state === "start") {
        if (text.startsWith('1')) {
          state = "room_type";
          addMessage("Choose Room Type:");
          showOptions(['1. AC', '2. Non-AC'], handleRoomType);
        } else if (text.startsWith('2')) {
          addMessage("AC Rooms Available: 3<br>Non-AC Rooms Available: 5");
          showOptions(["Book Now", "Cancel"], handleRoomType);
        } else if (text.startsWith('3')) {
          addMessage("üìû Support: Call 1800-ZIPPY");
        }
      } else if (state === "name") {
        if (!/^[a-zA-Z .]+$/.test(text)) {
          addMessage("‚ùå Name must only contain letters, space, dot.");
          return;
        }
        memory.name = text;
        state = "id_proof";
        addMessage("Select ID Proof:");
        showOptions(["Aadhaar", "Passport", "Submit at Hotel"], handleIdProof);
      } else if (state === "id_number") {
        memory.id_number = text;
        state = "nights";
        addMessage("How many days?");
        showOptions(["1 Day", "2 Days", "3 Days", "Custom"], handleNights);
      } else if (state === "nights") {
        if (text.toLowerCase().includes("custom")) {
          addMessage("Enter number of days:");
        } else {
          memory.nights = text.split(" ")[0];
          state = "date";
          addMessage("Select your booking date:");
          showOptions(["Today", "Tomorrow", "Choose Date"], handleDate);
        }
      } else if (state === "confirm") {
        if (text.toLowerCase() === "yes") {
          addMessage("‚úÖ Booking confirmed. Dummy Payment Processing...");
        } else {
          addMessage("‚ùå Booking cancelled.");
        }
      }
    }

    function handleRoomType(choice) {
      state = "room_category";
      memory.room_type = choice.includes("AC") ? "AC" : "Non-AC";
      addMessage("Select Room:");
      const prices = memory.room_type === "AC"
        ? ["Single - ‚Çπ1499", "Double - ‚Çπ1999", "Suite - ‚Çπ2499"]
        : ["Single - ‚Çπ999", "Double - ‚Çπ1499", "Suite - ‚Çπ1999"];
      showOptions(prices, askName);
    }

    function askName() {
      state = "name";
      input.placeholder = "Enter your name (letters only)";
      input.oninput = function () {
        this.value = this.value.replace(/[^a-zA-Z .]/g, '');
      };
      addMessage("Please enter your full name:");
    }

    function handleIdProof(choice) {
      memory.id_type = choice;
      if (choice.includes("Submit")) {
        memory.id_number = "To be submitted at hotel";
        state = "nights";
        addMessage("How many days?");
        showOptions(["1 Day", "2 Days", "3 Days", "Custom"], handleNights);
      } else {
        state = "id_number";
        addMessage("Enter ID number:");
      }
    }

    function handleNights(choice) {
      if (choice.includes("Day")) {
        memory.nights = choice.split(" ")[0];
        state = "date";
        addMessage("Select your booking date:");
        showOptions(["Today", "Tomorrow", "Choose Date"], handleDate);
      } else {
        addMessage("Enter number of days:");
      }
    }

    function handleDate(choice) {
      memory.date = choice;
      state = "confirm";
      const idMasked = memory.id_number.replace(/.(?=.{4})/g, "X");
      addMessage(`Confirm booking:<br>Name: ${memory.name}<br>Room: ${memory.room_type}<br>Nights: ${memory.nights}<br>Date: ${memory.date}<br>ID: ${idMasked}<br><br>Type 'yes' to confirm.`);
    }

    window.onload = initChat;
  </script>
</body>
</html>
