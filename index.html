<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Booking Chat Bot</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
    .chat-container { width: 380px; height: 600px; background: white; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
    .chat-box { flex: 1; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; }
    .message { margin: 5px; padding: 8px 12px; border-radius: 15px; max-width: 75%; }
    .bot { background-color: #e0f7fa; align-self: flex-start; }
    .user { background-color: #007aff; color: white; align-self: flex-end; }
    .input-area { display: flex; border-top: 1px solid #ddd; }
    .input-area input { flex: 1; padding: 10px; border: none; }
    .input-area button { padding: 10px; background: #007aff; color: white; border: none; }
    .options { display: flex; flex-wrap: wrap; margin-top: 10px; }
    .options button { margin: 4px; padding: 6px 12px; border: none; border-radius: 6px; background-color: #f1f1f1; cursor: pointer; }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-box" id="chat"></div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Type here only when necessary..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    let state = "start";
    let memory = {};

    function addMessage(text, sender = 'bot') {
      const div = document.createElement("div");
      div.className = `message ${sender}`;
      div.innerHTML = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, 'user');
      input.value = '';
      handleChat(text);
    }

    function showOptions(options, callback) {
      const div = document.createElement("div");
      div.className = "options";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          addMessage(opt, 'user');
          chat.removeChild(div);
          callback(opt);
        };
        div.appendChild(btn);
      });
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function initChat() {
      addMessage("Welcome to Zippy Stays! üè®");
      showOptions(["1. Room Booking", "2. Room Availability", "3. Support"], handleChat);
    }

    function handleChat(text) {
      if (state === "start") {
        if (text.startsWith('1')) {
          state = "room_type";
          addMessage("Please choose Room Type:");
          showOptions(['1. AC', '2. Non-AC'], handleRoomType);
        } else if (text.startsWith('2')) {
          addMessage("Available Rooms: AC (3), Non-AC (5)");
          addMessage("Do you want to book a room?");
          showOptions(['1. Yes, Book Room', '2. No'], handleRoomType);
        } else if (text.startsWith('3')) {
          addMessage("Support: üìû Call 1800-ZIPPY");
        }
      } else if (state === "name") {
        if (!/^[a-zA-Z .]+$/.test(text)) {
          addMessage("‚ùå Name should contain only letters, space, dot or hyphen.");
          return;
        }
        memory.name = text;
        state = "id_proof";
        addMessage("Select ID Proof:");
        showOptions(["1. Aadhaar", "2. Passport", "3. Submit at Hotel"], handleIdProof);
      } else if (state === "id_number") {
        memory.id_number = text;
        state = "nights";
        addMessage("How many days do you want to stay?");
        showOptions(["1 Day", "2 Days", "3 Days", "Custom"], handleNights);
      } else if (state === "nights") {
        if (text.includes("Day")) {
          memory.nights = text.split(" ")[0];
          state = "date";
          addMessage("Select your booking date:");
          showOptions(["Today", "Tomorrow", "Choose from Calendar"], handleDate);
        } else if (text.toLowerCase().includes("custom")) {
          addMessage("Please type how many days:");
        } else {
          memory.nights = text;
          state = "date";
          addMessage("Select your booking date:");
          showOptions(["Today", "Tomorrow", "Choose from Calendar"], handleDate);
        }
      } else if (state === "confirm") {
        if (text.toLowerCase() === "yes") {
          addMessage("‚úÖ Payment Processing... (Dummy Page)");
          addMessage("üßæ Booking Confirmed! GST Bill will be sent to your email.");
        } else {
          addMessage("‚ùå Booking Cancelled.");
        }
      }
    }

    function handleRoomType(choice) {
      state = "room_category";
      if (choice.startsWith('1')) {
        memory.room_type = "AC";
        addMessage("Select AC Room Type:");
        showOptions(['1. Single - ‚Çπ1499', '2. Double - ‚Çπ1999', '3. Suite - ‚Çπ2499'], askName);
      } else {
        memory.room_type = "Non-AC";
        addMessage("Select Non-AC Room Type:");
        showOptions(['1. Single - ‚Çπ999', '2. Double - ‚Çπ1499', '3. Suite - ‚Çπ1999'], askName);
      }
    }

    function askName() {
      state = "name";
      input.placeholder = "Enter your name (letters only)";
      input.oninput = function () {
        this.value = this.value.replace(/[^a-zA-Z .]/g, '');
      };
      addMessage("Please enter your full name:");
    }

    function handleIdProof(choice) {
      memory.id_type = choice;
      if (choice.includes("Submit")) {
        memory.id_number = "(To be submitted at Hotel)";
        state = "nights";
        addMessage("How many days do you want to stay?");
        showOptions(["1 Day", "2 Days", "3 Days", "Custom"], handleNights);
      } else {
        state = "id_number";
        input.placeholder = "Enter ID Number";
        addMessage("Enter your ID Number:");
      }
    }

    function handleNights(choice) {
      if (choice.includes("Day")) {
        memory.nights = choice.split(" ")[0];
        state = "date";
        addMessage("Select your booking date:");
        showOptions(["Today", "Tomorrow", "Choose from Calendar"], handleDate);
      } else {
        addMessage("Please type how many days:");
        state = "nights";
      }
    }

    function handleDate(choice) {
      memory.date = choice;
      state = "confirm";
      const idMasked = memory.id_number ? memory.id_number.replace(/.(?=.{4})/g, "X") : "";
      addMessage(`Please confirm your booking:<br>Name: ${memory.name}<br>Room: ${memory.room_type}<br>Nights: ${memory.nights}<br>ID: ${idMasked}<br>Date: ${memory.date}<br><br>Type 'yes' to confirm.`);
    }

    window.onload = initChat;
  </script>
</body>
</html>
